<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ISL Player Stats</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">

    <a href="index.html" class="btn btn-green">â¬… Back to Homepage</a>

    <header class="stats-header">
      <img src="logo.png" alt="ISL Logo" class="logo" />
      <h1>Player Stats</h1>
    </header>

    <div class="season-controls">
      <label for="seasonSelect">Select Season:</label>
      <select id="seasonSelect">
        <option value="Season2" selected>Season 2</option>
        <option value="Season1">Season 1</option>
      </select>
    </div>

    <div class="table-wrap">
      <table id="statsTable">
        <thead>
          <tr>
            <th class="th-green">Player</th>
            <th class="th-orange">Matches Played</th>
            <th class="th-green">G/A</th>
            <th class="th-orange">Average G/A</th>
          </tr>
        </thead>
        <tbody id="statsBody"></tbody>
      </table>
      <div id="loading" class="loading">Loading statsâ€¦</div>
    </div>

    <footer class="credit">Made by Vishruth Pidatala</footer>
  </div>

  <script>
    // ðŸ”— Your Google Apps Script Web App URL
    const API_BASE = "https://script.google.com/macros/s/AKfycby4on1tzzQs6CBpSQPLhebTRa6Gs3Xwqd2VT8mdc4YdQNmlCw_knBNcI3rD8mGeQmtd/exec";

    const seasonSelect = document.getElementById('seasonSelect');
    const tbody = document.getElementById('statsBody');
    const loading = document.getElementById('loading');

    document.addEventListener('DOMContentLoaded', () => {
      loadSeason('Season2');
      seasonSelect.addEventListener('change', e => loadSeason(e.target.value));
    });

    async function loadSeason(seasonName) {
      tbody.innerHTML = '';
      showLoading(true);

      try {
        const url = `${API_BASE}?season=${encodeURIComponent(seasonName)}`;
        const res = await fetch(url, { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);

        const data = await res.json();
        const rows = Array.isArray(data) ? data : [];

        // âœ… Sort ONLY by G/A (highest first)
        rows.sort((a, b) => toNum(b["G/A"]) - toNum(a["G/A"]));

        renderRows(rows);
      } catch (err) {
        console.error(err);
        tbody.innerHTML = `<tr><td colspan="4" style="color:#c00;">Failed to fetch stats. Check Apps Script deployment and sheet headers.</td></tr>`;
      } finally {
        showLoading(false);
      }
    }

    function renderRows(rows) {
      if (!rows.length) {
        tbody.innerHTML = `<tr><td colspan="4" style="opacity:.7;">No stats yet.</td></tr>`;
        return;
      }

      rows.forEach((r, i) => {
        const tr = document.createElement('tr');

        // Crowns for top 3
        const crown = i === 0 ? " ðŸ‘‘" : i === 1 ? " ðŸ¥ˆ" : i === 2 ? " ðŸ¥‰" : "";

        // Use fallback keys to avoid blank Season 1 names
        const player = r["Player"] ?? r["Players"] ?? "";
        const matches = r["Matches Played"] ?? r["Matches"] ?? "";
        const ga = r["G/A"] ?? r["Goals/Assists"] ?? "";
        const avg = r["Average G/A"] ?? r["Avg G/A"] ?? "";

        tr.innerHTML = `
          <td>${escapeHtml(player)}${crown}</td>
          <td>${escapeHtml(matches)}</td>
          <td>${escapeHtml(ga)}</td>
          <td>${escapeHtml(avg)}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function showLoading(show) {
      loading.style.display = show ? 'block' : 'none';
    }

    function toNum(v) {
      const n = Number(String(v).replace(/[^0-9.\-]/g, ''));
      return Number.isFinite(n) ? n : 0;
    }

    function escapeHtml(s) {
      return String(s)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#39;');
    }
  </script>
</body>
</html>
