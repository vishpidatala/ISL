<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lunchly Soccer Stats - Players</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&family=Open+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <!-- Favicon link -->
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        /* Specific styles for the stats page */
        body {
            padding: 20px; /* Add overall body padding for small screens */
            box-sizing: border-box;
        }
        .top-navigation {
            width: 100%;
            text-align: left; /* Align button to the left */
            margin-bottom: 20px; /* Space between button and header */
            padding-top: 10px; /* Ensure space from the top of the page */
            box-sizing: border-box;
        }

        /* Small button styling for navigation */
        .nav-button {
            background-color: var(--dark-blue);
            color: var(--white);
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em; /* Smaller font for navigation */
            font-weight: 700;
            text-decoration: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: inline-block; /* Ensures padding and width are respected */
            min-width: 120px; /* Ensure a minimum touch target size */
            text-align: center; /* Center text within the button */
        }

        .nav-button:hover {
            background-color: var(--orange);
        }

        /* Ensure header and table remain centered below the nav button */
        .header {
            display: flex; /* Already flex, good for aligning logo and title */
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap; /* Allow items to wrap on smaller screens */
            text-align: center; /* Center text if wrapped */
        }

        /* Responsive table wrapper */
        .table-responsive {
            overflow-x: auto; /* Allows horizontal scrolling for the table on small screens */
            width: 100%; /* Take full width */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }

        table {
            min-width: 600px; /* Ensure table has a minimum width, so it scrolls if needed */
            width: 100%; /* Take full width of its container */
            border-collapse: collapse;
            margin-top: 20px;
            background-color: var(--white);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            font-size: 1.1em;
            white-space: nowrap; /* Prevent text from wrapping in table cells */
        }

        th {
            background-color: var(--dark-blue);
            color: var(--white);
            font-weight: 700;
            text-transform: uppercase;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        /* Styling for the credit text */
        .credit-text {
            width: 100%; /* Take full width */
            text-align: right; /* Align text to the right */
            position: absolute; /* Position relative to the viewport */
            top: 10px; /* 10px from the top */
            right: 10px; /* 10px from the right */
            font-size: 0.9em; /* Smaller font size */
            color: var(--dark-blue); /* Use the dark blue for consistency */
            padding: 10px; /* Some padding around the text */
            box-sizing: border-box; /* Include padding in width calculation */
            z-index: 10; /* Ensure it's above other content */
        }

        @media (max-width: 768px) {
            .credit-text {
                font-size: 0.7em; /* Even smaller on mobile */
                top: 5px;
                right: 5px;
                text-align: center; /* Center on small screens to prevent overflow */
                position: relative; /* Change to relative on small screens to flow with content */
                margin-bottom: 10px; /* Add space if it's relative */
            }
            .header img {
                height: 50px; /* Slightly smaller logo on mobile */
                margin-right: 10px;
            }
            .header h1 {
                font-size: 2em; /* Adjust title size */
            }
            th, td {
                padding: 10px 8px; /* Reduce padding in table cells */
                font-size: 0.9em; /* Adjust table font size */
            }
            .nav-button {
                font-size: 0.9em; /* Adjust nav button size */
                padding: 8px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="credit-text">
        Made by Vishruth Pidatala
    </div>
    <div class="container">
        <!-- Button to go back to homepage -->
        <div class="top-navigation">
            <a href="index.html" class="nav-button">Back to Homepage</a>
        </div>

        <div class="header">
            <img src="logo.png" alt="ISL Logo">
            <h1>STATS</h1>
        </div>

        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Player</th>
                        <th>Goals</th>
                        <th>Assists</th>
                        <th>Matches Played</th>
                        <th>G/A</th>
                    </tr>
                </thead>
                <tbody id="stats-table-body">
                    <!-- This part will be filled in automatically by JavaScript -->
                </tbody>
            </table>
        </div>
        <div id="loading-message">Loading stats...</div>
    </div>

    <script>
        // This is the special link from Google Sheets that your website will read.
        // It now uses the 'api.codetabs.com' CORS proxy.
        const GOOGLE_SHEET_CSV_URL = 'https://api.codetabs.com/v1/proxy?query=https://docs.google.com/spreadsheets/d/e/2PACX-1vR7ykbOCg0it6tk4T_2oFeuzG2_WF4rAiMJjug0hzQox2hv5PNakkkyF5Lp91EFVdqU3v4uKEhLpXwJ/pub?output=csv';

        // This function fetches data from Google Sheet, sorts it by G/A, and populates the table.
        async function loadPlayerStats() {
            const tableBody = document.getElementById('stats-table-body');
            const loadingMessage = document.getElementById('loading-message');

            tableBody.innerHTML = ''; // Clear old data to prepare for new data
            loadingMessage.style.display = 'block'; // Show "Loading..." message

            try {
                const response = await fetch(GOOGLE_SHEET_CSV_URL);

                if (!response.ok) {
                    throw new Error('Network response was not ok. Could not get stats from Google Sheet.');
                }

                const csvText = await response.text();
                const rows = csvText.split('\n').filter(row => row.trim() !== '');

                if (rows.length <= 1) {
                    const newRow = tableBody.insertRow();
                    const cell = newRow.insertCell();
                    cell.colSpan = 5;
                    cell.textContent = "No player stats found in the Google Sheet.";
                    cell.style.textAlign = "center";
                    return;
                }

                // Parse data into an array of player objects for easier sorting
                const players = [];
                for (let i = 1; i < rows.length; i++) { // Start from 1 to skip header row
                    const columns = rows[i].split(',');
                    if (columns.length >= 5) {
                        const player = columns[0].trim();
                        const goals = parseInt(columns[1]) || 0;
                        const assists = parseInt(columns[2]) || 0;
                        const matchesPlayed = parseInt(columns[3]) || 0;
                        const ga = parseInt(columns[4]) || (goals + assists); // Use G/A from sheet, or calculate

                        players.push({
                            player: player,
                            goals: goals,
                            assists: assists,
                            matchesPlayed: matchesPlayed,
                            ga: ga
                        });
                    } else {
                        console.warn(`Row ${i + 1} skipped due to insufficient columns: ${rows[i]}`);
                    }
                }

                // Sort the players array by G/A in descending order (highest G/A first)
                players.sort((a, b) => b.ga - a.ga);

                // Now, populate the table with the sorted data
                players.forEach(playerData => {
                    const newRow = tableBody.insertRow();
                    newRow.insertCell().textContent = playerData.player;
                    newRow.insertCell().textContent = playerData.goals;
                    newRow.insertCell().textContent = playerData.assists;
                    newRow.insertCell().textContent = playerData.matchesPlayed;
                    newRow.insertCell().textContent = playerData.ga;
                });

            } catch (error) {
                console.error("Error loading stats:", error);
                const newRow = tableBody.insertRow();
                const cell = newRow.insertCell();
                cell.colSpan = 5;
                cell.textContent = "Failed to load stats. Please ensure the Google Sheet URL is correct and the sheet is published to the web as CSV. (Possible CORS issue)";
                cell.style.color = "red";
                cell.style.textAlign = "center";
            } finally {
                loadingMessage.style.display = 'none'; // Always hide the loading message when done
            }
        }

        document.addEventListener('DOMContentLoaded', loadPlayerStats);
    </script>
</body>
</html>
